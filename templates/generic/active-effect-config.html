<form class="{{cssClass}} arm5eActiveEffect" autocomplete="off">
  {{> "systems/arm5e/templates/generic/largeDialog-header.html" header="Inputs" }}
  <!-- Effect Header -->
  <header class="sheet-header effect-options">
    <img class="item-small-img" src="{{ data.ui.img }}" />
    <h1 class="effect-title">{{ data.ui.name }}</h1>
  </header>
  <!-- Effect Configuration Tabs -->
  <nav class="arm5eTabs sheet-tabs tabs">
    <a class="item" data-tab="details" style="font-size: 16pt; padding: 0px;"><i class="icon-Icon_Details"></i>
      {{localize "EFFECT.TabDetails"}}</a>
    <a class="item" data-tab="effects" style="font-size: 16pt; padding: 0px"><i class="icon-Icon_Effects"></i>
      {{localize "EFFECT.TabEffects"}}</a>
  </nav>

  <!-- Details Tab -->
  {{!-- Sheet Body --}}
  <section class="sheet-body effect-options" style="height: auto; min-height: 115px;">
    {{> "systems/arm5e/templates/generic/metalic-bar.html" topoffset="-6px"}}
    <section class="tab" data-tab="details">
      <div class="form-group">
        <label>{{ localize "EFFECT.Name" }}</label>
        <div class="form-fields">
          <input type="text" name="{{data.ui.nameAttr}}" value="{{ data.ui.name }}" class="resource" />
        </div>
      </div>

      <div class="form-group">
        <label>{{ localize "EFFECT.Icon" }}</label>
        <div class="form-fields">
          {{filePicker target="img" type="image"}}
          <input class="image" type="text" name="{{data.ui.imgAttr}}" placeholder="path/image.png"
            value="{{data.ui.img}}" />
        </div>
      </div>

      <div class="form-group">
        <label>{{ localize "EFFECT.Disabled" }}</label>
        <input type="checkbox" name="disabled" {{ checked data.disabled }} />
      </div>
      <div class="form-group">
        {{#if isGM}}
          <label>{{ localize "arm5e.generic.hidden" }}</label>
          <input type="checkbox" name="flags.arm5e.hidden" {{ checked data.flags.arm5e.hidden }} />
        {{/if}}
      </div>

      {{#if isItemEffect}}
        <div class="form-group">
          <label>{{ localize "EFFECT.Transfer" }}</label>
          <div class="form-fields">
            <input type="checkbox" name="transfer" {{checked data.transfer}} />
          </div>
        </div>
      {{/if}}
    </section>

    <!-- Effects Tab -->
    <section class="tab" data-tab="effects">
      <header class="effect-change effects-header flexrow">
        <div class="type">{{ localize "arm5e.sheet.type" }}</div>
        <div class="key">{{ localize "arm5e.sheet.attributes" }}</div>
        <div class="mode">{{ localize "arm5e.activeEffect.changeMode" }}</div>
        <div class="value">{{ localize "arm5e.activeEffect.changeValue" }}</div>
        <div class="effect-controls">
          <a class="effect-control" data-action="add"><i class="fas fa-plus"></i></a>
        </div>
      </header>
      <ol class="changes-list" style="min-height: 48px;">
        {{#each data.changes as |change i|}}
          <li class="effect-change">
            <div class="flexrow">
              <div class="type">
                <select data-type="String" class="effect-type" data-index="{{i}}">
                  {{selectOptions @root.types selected=(lookup ../selectedTypes i) labelAttr="mnemonic" localize=true}}
                </select>
              </div>
              <div class="subtype">
                <select class="effect-subtype" data-index="{{i}}">
                  {{selectOptions (lookup @root.subtypes i) selected=(lookup ../selectedSubtypes i) labelAttr="mnemonic" localize=true
                    nameAttr="name" valueAttr="name"}}
                </select>
                <div style="font-size: 8pt; overflow-wrap: break-word">{{#if ../devMode}}{{change.key}}{{/if}}</div>
              </div>
              <div class="mode">{{localize (lookup (lookup ../currentProperties i) "modeStr")}}</div>

              <div class="value">
                {{#if (lookup (lookup ../currentProperties i) "withChoice")}}
                  <select name="changes.{{i}}.value" data-index="{{i}}">
                    {{#select (lookup change "value") }} {{#each (lookup (lookup (lookup ../subtypes i) (lookup
                ../selectedSubtypes i)) "choice") as | value key|}}
                        <option value="{{key}}">{{localize value}}</option>
                      {{/each}} {{/select}}
                  </select>
                {{else if (lookup (lookup ../currentProperties i) "isBool")}}
                  <input class="effect-value" type="checkbox" name="changes.{{i}}.value" {{checked change.value}}
                    data-dtype="Boolean" data-index="{{i}}" />
                {{else if (lookup (lookup ../currentProperties i) "isString")}}
                  <input class="effect-value" type="text" name="changes.{{i}}.value" value="{{change.value}}"
                    data-dtype="String" data-index="{{i}}" />

                {{else}}
                  <input class="effect-value resource-focus" type="number" name="changes.{{i}}.value"
                    value="{{change.value}}" data-dtype="Number" data-index="{{i}}" />
                {{/if }}
              </div>

              <div class="effect-controls">
                {{#if (lookup (lookup ../currentProperties i) "option")}}
                  <a class="effect-control" data-idx="{{i}}" data-action="option"><i class="fas fa-cogs"></i></a>
                {{/if}}
                <a class="effect-control" data-idx="{{i}}" data-action="delete"><i
                    class="icon-Icon_Delete_Hand_Gesture"></i></a>
              </div>
            </div>
            <div style="position: absolute; right: -2300px">
              <input type="hidden" name="changes.{{i}}.mode" value="{{change.mode}}" data-dtype="Number" />
              <input type="hidden" name="changes.{{i}}.key" value="{{change.key}}" data-dtype="String" />

            </div>
          </li>
        {{/each}}
      </ol>
    </section>
  </section>

  {{> "systems/arm5e/templates/generic/largeDialog-footer.html" footer="Inputs"}}
  <!-- <button type="submit"><i class="fas fa-save"></i> {{localize submitText}}</button> -->
</form>